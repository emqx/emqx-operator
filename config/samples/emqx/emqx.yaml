## full example
apiVersion: apps.emqx.io/v1alpha2
kind: EmqxBroker
metadata:
  name: emqx
spec:
  serviceAccountName: "emqx"
  image: emqx/emqx:4.3.10
  replicas: 3
  labels:
    cluster: emqx
  storage:
    volumeClaimTemplate:
      spec:
        storageClassName: standard
        resources:
          requests:
            storage: 20Mi
        accessModes:
        - ReadWriteMany
  listener: 
    type: LoadBalancer
    ports:
      - name: mqtts
        protocol: TCP
        port: 8884
  acl: >
    {allow, {user, "dashboard"}, subscribe, ["$SYS/#"]}.
    {allow, {ipaddr, "127.0.0.1"}, pubsub, ["$SYS/#", "#"]}.
    {deny, all, subscribe, ["$SYS/#", {eq, "#"}]}.
    {allow, all}.
  plugins:
    - name: emqx_management
      enable: true
    - name: emqx_recon
      enable: true
    - name: emqx_retainer
      enable: true
    - name: emqx_dashboard
      enable: true
    - name: emqx_telemetry
      enable: true
    - name: emqx_rule_engine
      enable: true
    - name: emqx_bridge_mqtt
      enable: false
  modules:
    - name: emqx_mod_acl_internal
      enable: true
    - name: emqx_mod_presence
      enable: true